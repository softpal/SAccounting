@model StratusAccounting.Models.UMst_BusinessItems
@using StratusAccounting.Models;
@{
    ViewBag.Title = "Products";
    Layout = "~/Views/Shared/_DashboardLayout.cshtml";
    //var ImageFolder = ("~/Content/img/icon-close.png");
}

<h2>Products</h2>
@using (Html.BeginForm(new { ReturnUrl = ViewBag.ReturnUrl }))
{
    @Html.AntiForgeryToken()
    
    <div class="page-content">
        <!-- BEGIN PAGE CONTAINER-->
        <div class="container-fluid">
            <!-- BEGIN PAGE HEADER-->
            <div class="row-fluid">
                <div class="span12">

                    <!-- BEGIN PAGE TITLE & BREADCRUMB-->

                    <ul class="breadcrumb margin-top-20">
                        <li><i class="icon-home"></i><a href="/Home/Dashboard">Home</a> <i class="icon-angle-right"></i></li>
                        <li><a href="/Organization/Preferences">Oranization</a></li>
                        <li><i class="icon-angle-right"></i><a href="/Organization/Products">Products</a></li>
                    </ul>
                    <!-- END PAGE TITLE & BREADCRUMB-->
                </div>
            </div>
            <!-- END PAGE HEADER-->
            <!-- BEGIN PAGE CONTENT-->
            <div class="row-fluid">
                <div class="span12">
                    <!-- BEGIN SAMPLE FORM PORTLET-->
                    <div class="portlet box blue border-topf">

                        <div class="portlet-body form">
                            <h3 class="page-title matop border-btoom">Products&nbsp;<a href="~/Organization/Products"><i class="icon-plus-sign"></i></a></h3>
                            <div class="row-fluid">
                                <div class="span3">

                                    <div class="account-details">

                                        <ul class="no-left-margin">
                                            <div class="input-append">
                                                <input type="text" placeholder="Search" id="txtKeyword" class="m-wrap input-large" onkeyup="SearchProducts();" />
                                                <button type="button" class="btn blue"><i class="icon-search"></i></button>
                                            </div>
                                            <div id="lstProducts">
                                                @foreach (var item in ViewBag.BusinessItems)
                                                {
                                                    <li><a href="/Organization/EditProduct/?productId=@item.ItemId" >@item.Title</a><a onclick="DeleteProducts(@item.ItemId,this);" ><img src="~/Content/img/icon-close.png" alt="" class="account-detailsbg" /></a></li>
                                                }
                                            </div>
                                        </ul>
                                    </div>
                                </div>
                                <div class="span9 account-right">
                                    <div class="span12">
                                        <form class="horizontal-form" action="#">
                                            <div class="row-fluid margin-bottom-20">
                                                <span class="color1">@Html.ValidationSummary(true)</span> <a class="btn blue border-form-radius float-right" href="#"><i class="icon-print"></i>Print</a>
                                                <div class="control-group margin-top-20">
                                                    <label for="firstName" class="control-label"><span class="required">*</span>Title</label>
                                                    <div class="controls">
                                                        @if (@Model != null && @Model.ItemId > 0)
                                                        {
                                                            @Html.HiddenFor(model => model.ItemId)
                                                            @Html.HiddenFor(model => model.CreatedDate)
                                                        }
                                                        @Html.TextBoxFor(model => model.Title, new { @class = "m-wrap span12 border-form-radius" })
                                                        @Html.ValidationMessageFor(model => model.Title)
                                                    </div>
                                                </div>
                                                <div class="control-group">
                                                    <label for="firstName" class="control-label"><span class="required">*</span> Unique # <span class="color2">(manual entry)</span></label>
                                                    <div class="controls">
                                                        @Html.TextBoxFor(model => model.UniqueId, new { @class = "m-wrap span12 border-form-radius" })
                                                        @Html.ValidationMessageFor(model => model.UniqueId)
                                                    </div>
                                                </div>
                                                <div class="control-group">
                                                    <label for="firstName" class="control-label">Description </label>
                                                    <div class="controls">
                                                        @Html.TextBoxFor(model => model.Description, new { rows = 3, @class = "m-wrap span12 border-form-radius" })
                                                        @Html.ValidationMessageFor(model => model.Description)
                                                    </div>
                                                </div>
                                                <div class="control-group">
                                                    <div class="span4">
                                                        <label for="firstName" class="control-label">Cost Price</label>
                                                        <div class="controls">
                                                            @Html.TextBoxFor(model => model.CostPrice, new { @class = "m-wrap span12 border-form-radius" })
                                                            @Html.ValidationMessageFor(model => model.CostPrice)
                                                        </div>
                                                    </div>
                                                    <div class="span4">
                                                        <label for="firstName" class="control-label">Discount Price</label>
                                                        <div class="controls">
                                                            @Html.TextBoxFor(model => model.DiscountPrice, new { @class = "m-wrap span12 border-form-radius" })
                                                            @Html.ValidationMessageFor(model => model.DiscountPrice)
                                                        </div>
                                                    </div>
                                                    <div class="span4">
                                                        <label for="firstName" class="control-label">Preferred Price</label>
                                                        <div class="controls">
                                                            @Html.TextBoxFor(model => model.PreferredPrice, new { @class = "m-wrap span12 border-form-radius" })
                                                            @Html.ValidationMessageFor(model => model.PreferredPrice)
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="control-group">
                                                    <label for="firstName" class="control-label">Category</label>
                                                    <div class="controls">
                                                        <a data-toggle="modal" href="#responsive"><i class="icon-plus-sign"></i></a>
                                                        <div id="responsive" class="modal hide fade" tabindex="-1" data-width="760">
                                                            @Html.Partial("ChartofAccounts/ChartofAccounts", new UMst_UserAccounts())
                                                            @*@Html.Partial("ChartofAccounts/ChartofAccounts", new { catid = ViewBag.ParentAccounts});*@
                                                        </div>
                                                        @Html.DropDownListFor(model => model.UserAccountsId, (SelectList)ViewBag.AccountTypeList, "--select--", new { @class = "m-wrap span12 border-form-radius" })
                                                        @Html.ValidationMessageFor(model => model.UserAccountsId)
                                                    </div>
                                                </div>
                                                <div class="control-group">
                                                    <div class="controls">

                                                        <div class="radio">
                                                            <span>
                                                                @Html.CheckBoxFor(model => model.Taxable, new { @class = "radio" })
                                                                <label for="firstName" class="control-label">Is&nbsp;Taxable?</label>
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-actions">
                                                <button id="btnSave" type="submit" class="btn blue"><i class="icon-ok"></i>Save</button>
                                                <a class="btn" href="~/Organization/Projects">Cancel</a>
                                                <!--  <button class="btn" type="button">Cancel</button>-->
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- END SAMPLE FORM PORTLET-->
                </div>
            </div>
        </div>

        <!-- END PAGE CONTENT-->
    </div>
    <!-- END PAGE CONTAINER-->
    
    @Scripts.Render("~/bundle/Script/Dashboard")
}

<script type="text/javascript">
    function DeleteProducts(objId, objectElement) {
        $.ajax({
            url: '/Organization/DeleteProduct/',
            type: "Post",
            dataType: "Json",
            //contentType: 'application/json, charset=utf-8',
            data: { "productId": objId },
            success: function () {
                //debugger;  //var result = msg.data;
                alert("Deleted Successfully .");
                $(objectElement).parent().css("display", "none");
            },
            error: function (error) {
                //debugger;
                alert(error.responseText);
            }
        });
    }

    function SearchProducts() {
        var keyword = $("#txtKeyword").val();
        document.getElementById("lstProducts").innerHTML = '';
        $.ajax({
            type: "POST",
            contentType: "application/json",
            url: "/Organization/BindSearchProducts",
            data: JSON.stringify({ "prefix": keyword }),
            success: function (data) {
                if (data.length > 0) {
                    var childString = '';
                    document.getElementById("lstProducts").innerHTML = '';
                    for (var i = 0; i < data.length; i++) {
                        childString += '<li><a href="EditProduct/?productId=' + data[i].ProductsId + '" >' + data[i].ProductsTitle + '</a><a onclick="DeleteProjects(' + data[i].ProductsId + ',this);" ><img src="\\Content\\img\\icon-close.png" alt="" class="account-detailsbg" /></a></li>';
                    }
                    $("#lstProducts").append(childString);
                }
            },
            error: function (data) {
                /// debugger;
            }
        });
    }

</script>
